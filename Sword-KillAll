local aB3dE,bT2xK,cL9pR=game:service'Players',game:service'RunService',game:service'CoreGui'
local dV6nH=aB3dE.LocalPlayer
local eJ3sW,fY8kP,gR1cU,hN2mQ={}, {}, nil, false
local iP4sT,jK7uL,kM8qT,lQ3wE=nil,nil,nil,nil

local mF9xC=Instance.new('ScreenGui')
mF9xC.ResetOnSpawn=false
mF9xC.Parent=cL9pR
local nR5vB=Instance.new('Frame')
nR5vB.Size=UDim2.new(0,150,0,46)
nR5vB.Position=UDim2.new(0,12,1,-58)
nR5vB.BackgroundTransparency=.35
nR5vB.BorderSizePixel=0
nR5vB.BackgroundColor3=Color3.fromRGB(0,0,0)
nR5vB.Parent=mF9xC
Instance.new('UICorner',nR5vB).CornerRadius=UDim.new(0,14)
local oT1zK=Instance.new('UIStroke')
oT1zK.Thickness=2
oT1zK.Transparency=.25
oT1zK.Color=Color3.fromRGB(255,255,255)
oT1zK.Parent=nR5vB
local pD9hV=Instance.new('TextButton')
pD9hV.Size=UDim2.new(1,-10,1,-10)
pD9hV.Position=UDim2.new(0,5,0,5)
pD9hV.BackgroundTransparency=0
pD9hV.BorderSizePixel=0
pD9hV.BackgroundColor3=Color3.fromRGB(0,0,0)
pD9hV.AutoButtonColor=false
pD9hV.Font=Enum.Font.Code
pD9hV.TextSize=20
pD9hV.Text='OFF'
pD9hV.TextTransparency=.05
pD9hV.TextColor3=Color3.fromRGB(255,255,255)
pD9hV.Parent=nR5vB
Instance.new('UICorner',pD9hV).CornerRadius=UDim.new(0,12)
local qW8cS=Instance.new('UIStroke')
qW8cS.Thickness=1
qW8cS.Transparency=.35
qW8cS.Color=Color3.fromRGB(255,255,255)
qW8cS.Parent=pD9hV

local function rP2vN(p)while p do if p.ClassName=='Accessory'then return 1 end p=p.Parent end end
local function sV4kZ(c)for _,v in ipairs(c:GetChildren())do if v:IsA'Humanoid'then return v end end end
local function tX7rW(c)for _,v in ipairs(c:GetChildren())do if v:IsA'ForceField'then return 1 end end end
local function uX5bC(c)for _,v in ipairs(c:GetChildren())do if v.Name=='Head'and v:IsA'BasePart'then return v end end end
local function wJ7nL()
	local c=dV6nH.Character
	if not c then return end
	for _,v in ipairs(c:GetChildren())do
		local n=v.Name
		if (n=='RightHand'or n=='RightLowerArm'or n=='RightUpperArm'or n=='Right Arm')and v:IsA'BasePart'then gR1cU=v return end
	end
end

local function xT7rW(p)
	fY8kP[p]=os.clock()
	p.AncestryChanged:Connect(function(_,pp)
		if not pp then
			fY8kP[p]=nil
			if eJ3sW[p]then for i=1,#eJ3sW[p]do local m,ppp,hd=eJ3sW[p][i][1],eJ3sW[p][i][2],eJ3sW[p][i][3] if m and m.Parent==nil then m.Parent=(ppp and ppp.Parent and ppp)or(hd and hd.Parent and hd)or nil end end eJ3sW[p]=nil end
			if kM8qT==p then kM8qT=nil lQ3wE=nil end
		end
	end)
	p.CharacterAdded:Connect(function()
		fY8kP[p]=os.clock()
		if kM8qT==p then kM8qT=nil lQ3wE=nil end
	end)
end
for _,p in ipairs(aB3dE:GetPlayers())do if p~=dV6nH then xT7rW(p)end end
aB3dE.PlayerAdded:Connect(function(p)if p~=dV6nH then xT7rW(p)end end)
aB3dE.PlayerRemoving:Connect(function(p)fY8kP[p]=nil if eJ3sW[p]then eJ3sW[p]=nil end if kM8qT==p then kM8qT=nil lQ3wE=nil end end)

local function yZ6aD(c,hd,t)
	t=t or{[0]={}}
	local s=t[0]
	for _,m in ipairs(c:GetDescendants())do
		if (m:IsA'Motor6D'or m:IsA'Weld'or m:IsA'WeldConstraint')and not s[m]then
			local p0,p1=m.Part0,m.Part1
			local o=nil
			if p0==hd then o=p1 elseif p1==hd then o=p0 end
			if o and not rP2vN(o)then t[#t+1]={m,m.Parent,hd}s[m]=1 m.Parent=nil end
		end
	end
	return t
end
local function zQ3aS(p)
	local t=eJ3sW[p]
	if not t then return end
	for i=1,#t do
		local m,pp,hd=t[i][1],t[i][2],t[i][3]
		if m and m.Parent==nil then m.Parent=(pp and pp.Parent and pp)or(hd and hd.Parent and hd)or nil end
	end
	eJ3sW[p]=nil
end

dV6nH.CharacterAdded:Connect(function(c)
	gR1cU=nil
	wJ7nL()
	c.ChildAdded:Connect(function(v)
		local n=v.Name
		if (n=='RightHand'or n=='RightLowerArm'or n=='RightUpperArm'or n=='Right Arm')and v:IsA'BasePart'then gR1cU=v end
	end)
end)
if dV6nH.Character then wJ7nL()end

local function A1b2C()
	if not hN2mQ then return end
	if not gR1cU or not gR1cU.Parent then wJ7nL()end
	local L={}
	for p,t0 in pairs(fY8kP)do
		local c=p.Character
		if c and os.clock()-t0>0.1 and not tX7rW(c)then
			local h=sV4kZ(c)
			if h and h.Health>0 then
				local hd=uX5bC(c)
				if hd and hd.Parent then L[#L+1]=p end
			end
		end
	end
	local np=L[math.random(#L)]
	if not np then
		if kM8qT then zQ3aS(kM8qT) kM8qT=nil lQ3wE=nil end
		return
	end
	if kM8qT~=np then
		if kM8qT then zQ3aS(kM8qT) end
		kM8qT=np
		lQ3wE=nil
	end
	local c=np.Character
	if not c then if kM8qT then zQ3aS(kM8qT) kM8qT=nil lQ3wE=nil end return end
	local hd=uX5bC(c)
	if not hd or not hd.Parent then if kM8qT then zQ3aS(kM8qT) kM8qT=nil lQ3wE=nil end return end
	eJ3sW[np]=yZ6aD(c,hd,eJ3sW[np])
	if not gR1cU or not gR1cU.Parent then return end
	local base=gR1cU.CFrame*CFrame.new(0,-1,1)
	local rx,ry,rz=math.rad(math.random(-180,180)),math.rad(math.random(-180,180)),math.rad(math.random(-180,180))
	hd.CFrame=base*CFrame.Angles(rx,ry,rz)
	hd.Velocity=Vector3.new(0,1)
	hd.RotVelocity=Vector3.new()
	lQ3wE=hd
end

local function D3e4F()
	if not hN2mQ then return end
	local hd=lQ3wE
	if hd and hd.Parent then hd.CanCollide=false end
end

pD9hV.MouseButton1Click:Connect(function()
	hN2mQ=not hN2mQ
	pD9hV.Text=hN2mQ and'ON'or'OFF'
	if hN2mQ then
		if iP4sT then iP4sT:Disconnect()end
		if jK7uL then jK7uL:Disconnect()end
		iP4sT=bT2xK.Heartbeat:Connect(A1b2C)
		jK7uL=bT2xK.RenderStepped:Connect(D3e4F)
	else
		if iP4sT then iP4sT:Disconnect()iP4sT=nil end
		if jK7uL then jK7uL:Disconnect()jK7uL=nil end
		if kM8qT then zQ3aS(kM8qT) kM8qT=nil lQ3wE=nil end
		local rm={}
		for p,_ in pairs(eJ3sW)do rm[#rm+1]=p end
		for i=1,#rm do zQ3aS(rm[i])end
	end
end)
